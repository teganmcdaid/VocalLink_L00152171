name: SonarCloud Analysis
#run on push to master
on:
  pull_request:
    branches: [master]
  push:
    branches: [master]

jobs:
  sonarcloud:
    name: SonarCloud
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v2

      - name: Setup_dotnet
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Install_workloads
        run: dotnet workload install maui 

      - name: Install SonarScanner
        run: dotnet tool install --global dotnet-sonarscanner

      #need to add tool to path so recognised
      - name: Add scanner to PATH
        run: echo "${{ env.USERPROFILE }}\.dotnet\tools" >> $GITHUB_PATH

      #run analysis
      - name: Start SonarCloud
        run: dotnet sonarscanner begin /k:"VocalLink_L00152171" /o:"teganmcdaid" /d:sonar.token="${{ secrets.SONAR_TOKEN }}" /d:sonar.host.url="https://sonarcloud.io"
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

      - name: Restore_dependencies
        run: dotnet restore VocalLink_L00152171.sln

      - name: Build
        run: dotnet build VocalLink_L00152171.sln

      - name: End SonarCloud
        run: dotnet sonarscanner end /d:sonar.token="${{ secrets.SONAR_TOKEN }}"
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
