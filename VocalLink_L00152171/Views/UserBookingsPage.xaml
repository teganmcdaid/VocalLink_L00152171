<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="VocalLink_L00152171.Views.UserBookingsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:m="clr-namespace:VocalLink_L00152171.Model"
    xmlns:vm="clr-namespace:VocalLink_L00152171.ViewModels"
    Title="UserBookingsPage"
    x:DataType="vm:UserBookingsViewModel">

    <ContentPage.BindingContext>
        <vm:UserBookingsViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="15">
            <Label
                x:Name="welcomeLabel"
                FontAttributes="Bold"
                FontSize="20"
                HorizontalOptions="Center"
                TextColor="DarkBlue" />

            <!--  Legend  -->
            <Label FontAttributes="Bold" Text="Legend:" />
            <HorizontalStackLayout Spacing="15">

                <HorizontalStackLayout>
                    <BoxView
                        HeightRequest="20"
                        WidthRequest="20"
                        Color="LightGreen" />
                    <Label
                        Margin="5,0,0,0"
                        Text="Booked"
                        VerticalOptions="Center" />
                </HorizontalStackLayout>
                <HorizontalStackLayout>
                    <BoxView
                        HeightRequest="20"
                        WidthRequest="20"
                        Color="LightYellow" />
                    <Label
                        Margin="5,0,0,0"
                        Text="Pending"
                        VerticalOptions="Center" />
                </HorizontalStackLayout>
                <HorizontalStackLayout>
                    <BoxView
                        HeightRequest="20"
                        WidthRequest="20"
                        Color="LightCoral" />
                    <Label
                        Margin="5,0,0,0"
                        Text="Declined"
                        VerticalOptions="Center" />
                </HorizontalStackLayout>
            </HorizontalStackLayout>

            <!--  Bookings List  -->
            <Label
                Margin="0,10,0,5"
                FontAttributes="Bold"
                Text="My Bookings:" />
            <CollectionView ItemsSource="{Binding Bookings}">
                <CollectionView.EmptyView>
                    <Label
                        FontAttributes="Italic"
                        HorizontalOptions="Center"
                        Text="You have no bookings yet."
                        TextColor="Gray"
                        VerticalOptions="Center" />
                </CollectionView.EmptyView>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="m:Booking">
                        <Frame
                            Margin="0,5"
                            Padding="10"
                            BorderColor="Gray"
                            CornerRadius="8">
                            <Frame.Triggers>
                                <DataTrigger
                                    Binding="{Binding Status}"
                                    TargetType="Frame"
                                    Value="Pending">
                                    <Setter Property="BackgroundColor" Value="LightYellow" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding Status}"
                                    TargetType="Frame"
                                    Value="Booked">
                                    <Setter Property="BackgroundColor" Value="LightGreen" />
                                </DataTrigger>
                                <DataTrigger
                                    Binding="{Binding Status}"
                                    TargetType="Frame"
                                    Value="Declined">
                                    <Setter Property="BackgroundColor" Value="LightCoral" />
                                </DataTrigger>
                            </Frame.Triggers>
                            <VerticalStackLayout>
                                <Label Text="{Binding Date, StringFormat='Date: {0:dd MMM yyyy}'}" />
                                <Label Text="{Binding Status, StringFormat='Status: {0}'}" />
                                <Label Text="{Binding SingerName, StringFormat='Singer: {0}'}" />
                                <Label Text="{Binding BusinessEmail, StringFormat='Booked by: {0}'}" />

                                <!--  Accept / Decline for singers and pending bookings  -->
                                <HorizontalStackLayout IsVisible="{Binding ., Converter={StaticResource PendingBookingVisibilityConverter}}" Spacing="10">
                                    <Button
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:UserBookingsViewModel}}, Path=AcceptCommand}"
                                        CommandParameter="{Binding .}"
                                        Text="Accept" />
                                    <Button
                                        BackgroundColor="Red"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:UserBookingsViewModel}}, Path=DeclineCommand}"
                                        CommandParameter="{Binding .}"
                                        Text="Decline"
                                        TextColor="White" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
